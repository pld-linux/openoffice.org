diff -Nur oo/berkeleydb/makefile.mk oo.new/berkeleydb/makefile.mk
--- oo/berkeleydb/makefile.mk	Fri Feb  8 16:18:17 2002
+++ oo.new/berkeleydb/makefile.mk	Sun Apr 14 23:56:12 2002
@@ -117,12 +117,12 @@
 
 .INCLUDE : set_ext.mk
 .INCLUDE :	target.mk
-.INCLUDE :	tg_ext.mk
+#.INCLUDE :	tg_ext.mk
 
-TG_DELIVER : $(INPATH)$/misc$/build$/so_predeliver
-		$(DELIVER)
+#TG_DELIVER : $(INPATH)$/misc$/build$/so_predeliver
+#		$(DELIVER)
 
-.IF "$(BUILD_SOSL)"!=""
-ALLTAR : TG_DELIVER
-.ENDIF			# "$(BUILD_SOSL)"!=""
+#.IF "$(BUILD_SOSL)"!=""
+#ALLTAR : TG_DELIVER
+#.ENDIF			# "$(BUILD_SOSL)"!=""
 
diff -Nur oo/config_office/makefile.rc oo.new/config_office/makefile.rc
--- oo/config_office/makefile.rc	Fri Oct 19 17:25:23 2001
+++ oo.new/config_office/makefile.rc	Sun Apr 14 23:56:12 2002
@@ -155,7 +155,6 @@
 	so3 \
 	soltools \
 	sot \
-	berkeleydb \
 	starmath \
 	stoc \
 	store \
diff -Nur oo/xmlhelp/source/cxxhelp/provider/databases.cxx oo.new/xmlhelp/source/cxxhelp/provider/databases.cxx
--- oo/xmlhelp/source/cxxhelp/provider/databases.cxx	Fri Nov 23 17:51:01 2001
+++ oo.new/xmlhelp/source/cxxhelp/provider/databases.cxx	Mon Apr 15 10:59:50 2002
@@ -60,7 +60,7 @@
  ************************************************************************/
 
 
-#include <berkeleydb/db_cxx.h>
+#include <db_cxx.h>
 #ifndef _VOS_DIAGNOSE_HXX_
 #include <vos/diagnose.hxx>
 #endif
diff -Nur oo/xmlhelp/source/cxxhelp/provider/urlparameter.cxx oo.new/xmlhelp/source/cxxhelp/provider/urlparameter.cxx
--- oo/xmlhelp/source/cxxhelp/provider/urlparameter.cxx	Wed Oct 31 14:08:14 2001
+++ oo.new/xmlhelp/source/cxxhelp/provider/urlparameter.cxx	Mon Apr 15 11:05:50 2002
@@ -88,7 +88,7 @@
 #include <sablot/shandler.h>
 #endif
 #ifndef _DB_CXX_H_
-#include <berkeleydb/db_cxx.h>
+#include <db_cxx.h>
 #endif
 #ifndef _URLPARAMETER_HXX_
 #include <provider/urlparameter.hxx>
--- oo_1.0_src/setup2/script/linux/1.0.0/webinstdb.inf.systemdb	Fri May 31 17:46:36 2002
+++ oo_1.0_src/setup2/script/linux/1.0.0/webinstdb.inf	Fri May 31 17:47:08 2002
@@ -6687,7 +6687,7 @@
 End
 
 File gid_File_Lib_Db31
-	Name		 = "libdb-3.1.so";
+	Name		 = "libdb-4.1.so";
 	PackedName	 = "f_0352";
 	Size		 = 458008;
 	Dir			 = gid_Dir_Program;
@@ -6700,7 +6700,7 @@
 End
 
 File gid_File_Lib_Dbjava31
-	Name		 = "libdb_java-3.1.so";
+	Name		 = "libdb_java-4.1.so";
 	PackedName	 = "f_0353";
 	Size		 = 506820;
 	Dir			 = gid_Dir_Program;
--- oo_1.0_src/setup2/script/linux/1.0.1/webinstdb.inf.systemdb	Fri May 31 17:47:16 2002
+++ oo_1.0_src/setup2/script/linux/1.0.1/webinstdb.inf	Fri May 31 17:47:27 2002
@@ -7474,7 +7474,7 @@
 End
 
 File gid_File_Lib_Db31
-	Name		 = "libdb-3.1.so";
+	Name		 = "libdb-4.1.so";
 	PackedName	 = "f_0358";
 	Size		 = 458008;
 	DownloadSize = 196814;
@@ -7488,7 +7488,7 @@
 End
 
 File gid_File_Lib_Dbjava31
-	Name		 = "libdb_java-3.1.so";
+	Name		 = "libdb_java-4.1.so";
 	PackedName	 = "f_0359";
 	Size		 = 506820;
 	DownloadSize = 212931;
--- oo_1.0_src/setup2/script/linux/1.1.1/webinstdb.inf.systemdb	Fri May 31 17:47:37 2002
+++ oo_1.0_src/setup2/script/linux/1.1.1/webinstdb.inf	Fri May 31 17:47:48 2002
@@ -7512,7 +7512,7 @@
 End
 
 File gid_File_Lib_Db31
-	Name		 = "libdb-3.1.so";
+	Name		 = "libdb-4.1.so";
 	PackedName	 = "f_0361";
 	Size		 = 458008;
 	DownloadSize = 196814;
@@ -7526,7 +7526,7 @@
 End
 
 File gid_File_Lib_Dbjava31
-	Name		 = "libdb_java-3.1.so";
+	Name		 = "libdb_java-4.1.so";
 	PackedName	 = "f_0362";
 	Size		 = 506820;
 	DownloadSize = 212931;
--- oo_1.0_src/scp/source/office/files.scp.systemdb	Fri May 31 17:43:01 2002
+++ oo_1.0_src/scp/source/office/files.scp	Fri May 31 17:43:37 2002
@@ -994,7 +994,7 @@
         Styles          = (PACKED);
         Dir             = GID_DIR_PROGRAM;
         #ifdef UNX
-        Name            = "libdb-3.2.so";
+        Name            = "libdb-4.1.so";
         #else
         Name            = "libdb32.dll";
         #endif
@@ -1007,7 +1007,7 @@
         Styles          = (PACKED);
         Dir             = GID_DIR_PROGRAM;
         #ifdef UNX
-        Name            = "libdb_java-3.2.so";
+        Name            = "libdb_java-4.1.so";
         #else
         Name            = "libdb_java32.dll";
         #endif
@@ -1021,7 +1021,7 @@
         BIN_FILE_BODY;
         Styles          = (PACKED);
         Dir             = GID_DIR_PROGRAM;
-        Name            = "libdb_cxx-3.2.so";
+        Name            = "libdb_cxx-4.1.so";
 End
 
 #endif
--- oo_1.0_src/solenv/inc/libs.mk.systemdb	Fri May 31 17:43:57 2002
+++ oo_1.0_src/solenv/inc/libs.mk	Fri May 31 17:45:32 2002
@@ -169,8 +169,8 @@
 ZLIB3RDLIB=-lzlib
 JPEG3RDLIB=-ljpeglib
 NEON3RDLIB=-lneon
-BERKELEYLIB=-ldb-3.2
-BERKELEYCPPLIB=-ldb_cxx-3.2
+BERKELEYLIB=-ldb-4.1
+BERKELEYCPPLIB=-ldb_cxx-4.1
 SFX2LIB=-lsfx$(UPD)$(DLLPOSTFIX)
 SFXLIB=-lsfx$(UPD)$(DLLPOSTFIX)
 SFXDEBUGLIB=
--- oo_1.0_src/berkeleydb/prj/d.lst.systemdb	Fri May 31 17:38:58 2002
+++ oo_1.0_src/berkeleydb/prj/d.lst	Fri May 31 17:42:14 2002
@@ -1,18 +1,20 @@
 mkdir: %_DEST%\inc%_EXT%\berkeleydb
 
-..\%__SRC%\inc\db_cxx.h %_DEST%\inc%_EXT%\berkeleydb\db_cxx.h
-..\%__SRC%\inc\db_185.h %_DEST%\inc%_EXT%\berkeleydb\db_185.h
-..\%__SRC%\inc\db.h %_DEST%\inc%_EXT%\berkeleydb\db.h
+\usr\include\db_cxx.h %_DEST%\inc%_EXT%\berkeleydb\db_cxx.h
+\usr\include\cxx_common.h %_DEST%\inc%_EXT%\berkeleydb\cxx_common.h
+\usr\include\cxx_except.h %_DEST%\inc%_EXT%\berkeleydb\cxx_except.h
+\usr\include\db_185.h %_DEST%\inc%_EXT%\berkeleydb\db_185.h
+\usr\include\db.h %_DEST%\inc%_EXT%\berkeleydb\db.h
 
 ..\%__SRC%\lib\libdb32.lib %_DEST%\lib%_EXT%\libdb32.lib
 ..\%__SRC%\lib\libdb_java32.lib %_DEST%\lib%_EXT%\libdb_java32.lib
 
-..\%__SRC%\lib\libdb-3.2.so %_DEST%\lib%_EXT%\libdb-3.2.so
-..\%__SRC%\lib\libdb_java-3.2.so %_DEST%\lib%_EXT%\libdb_java-3.2.so
-..\%__SRC%\lib\libdb_cxx-3.2.so %_DEST%\lib%_EXT%\libdb_cxx-3.2.so
+\usr\lib\libdb-4.1.so %_DEST%\lib%_EXT%\libdb-4.1.so
+\usr\lib\libdb_java-4.1.so %_DEST%\lib%_EXT%\libdb_java-4.1.so
+\usr\lib\libdb_cxx-4.1.so %_DEST%\lib%_EXT%\libdb_cxx-4.1.so
 
 ..\%__SRC%\bin\libdb32.dll %_DEST%\bin%_EXT%\libdb32.dll
 ..\%__SRC%\bin\libdb_java32.dll %_DEST%\bin%_EXT%\libdb_java32.dll
 
-..\%__SRC%\bin\db.jar %_DEST%\bin%_EXT%\db.jar
+\usr\share\java\db.jar %_DEST%\bin%_EXT%\db.jar
 
--- oo_1.0_src/berkeleydb/makefile.mk.systemdb	Fri May 31 17:34:42 2002
+++ oo_1.0_src/berkeleydb/makefile.mk	Fri May 31 17:38:51 2002
@@ -65,6 +65,16 @@
 PRJNAME=so_berkeleydb
 TARGET=so_berkeleydb
 
+# --- Hack to get system db libraries ------------------------------
+.IF "$(GUI)"=="UNX"
+all:
+	@echo "Since you're running a real OS, we're assuming you have db..."
+	+$(COPY) /usr$/lib$/libdb-4.1.so $(DLLDEST)
+	+$(COPY) /usr$/lib$/libdb_cxx-4.1.so $(DLLDEST)
+	+$(COPY) /usr$/lib$/libdb_java-4.1.so $(DLLDEST)
+	+$(COPY) /usr$/lib$/db.jar $(DLLDEST)
+.ENDIF
+
 # --- Settings -----------------------------------------------------
 
 .INCLUDE :	settings.mk
diff -uNr xmlhelp.old/source/com/sun/star/help/CreateDb.java xmlhelp/source/com/sun/star/help/CreateDb.java
--- oo/xmlhelp.old/source/com/sun/star/help/CreateDb.java	Wed Dec  4 15:19:26 2002
+++ oo/xmlhelp/source/com/sun/star/help/CreateDb.java	Wed Dec  4 15:47:07 2002
@@ -37,7 +37,7 @@
 		table.set_errpfx( "HelpAccess" );
 		try
 		{
-			table.open( dbName,null,Db.DB_BTREE,Db.DB_RDONLY,0644 );
+			table.open( null,dbName,null,Db.DB_BTREE,Db.DB_RDONLY,0644 );
 			Dbc cursor = table.cursor( null,0 );
 
 			StringDbt key = new StringDbt();
@@ -131,7 +131,7 @@
       		Db table = new Db(null, 0);
       		table.set_error_stream(System.err);
       		table.set_errpfx("AccessExample");
-      		table.open("e:/rvp603b/help/helpaccess.db", null, Db.DB_HASH, Db.DB_CREATE, 0644);
+      		table.open(null,"e:/rvp603b/help/helpaccess.db", null, Db.DB_HASH, Db.DB_CREATE, 0644);
       		StringDbt key = new StringDbt(key1);
       		StringDbt data = new StringDbt(data1);
       		try
diff -uNr xmlhelp.old/source/com/sun/star/help/HelpDatabases.java xmlhelp/source/com/sun/star/help/HelpDatabases.java
--- oo/xmlhelp.old/source/com/sun/star/help/HelpDatabases.java	Wed Dec  4 15:19:26 2002
+++ oo/xmlhelp/source/com/sun/star/help/HelpDatabases.java	Wed Dec  4 15:46:17 2002
@@ -239,7 +239,7 @@
 				table = new Db( null,0 );
 
 				String tablePath = _installDirectory + key + ".db";
-				table.open( tablePath,null,Db.DB_BTREE,Db.DB_RDONLY,0644 );
+				table.open( null,tablePath,null,Db.DB_BTREE,Db.DB_RDONLY,0644 );
 				_dbHash.put( key,table );
             }
             catch( DbException e )
@@ -274,7 +274,7 @@
 				table = new Db( null,0 );
 
 				String tablePath = _installDirectory + key + ".ht";
-				table.open( tablePath,null,Db.DB_BTREE,Db.DB_RDONLY,0644 );
+				table.open( null,tablePath,null,Db.DB_BTREE,Db.DB_RDONLY,0644 );
 				_dbHash.put( key,table );
             }
             catch( DbException e )
@@ -517,7 +517,7 @@
 				String fileName = HelpDatabases.getInstallDirectory() + keyStr + ".key";
         		Db table = new Db( null,0 );
 				System.err.println( fileName );
-				table.open( fileName,null,Db.DB_BTREE,Db.DB_RDONLY,0644 );
+				table.open( null,fileName,null,Db.DB_BTREE,Db.DB_RDONLY,0644 );
 				Dbc cursor = table.cursor( null,0 );
 				StringDbt key = new StringDbt();
 				StringDbt data = new StringDbt();
diff -uNr xmlhelp.old/source/com/sun/star/help/HelpIndexer.java xmlhelp/source/com/sun/star/help/HelpIndexer.java
--- oo/xmlhelp.old/source/com/sun/star/help/HelpIndexer.java	Wed Dec  4 15:19:26 2002
+++ oo/xmlhelp/source/com/sun/star/help/HelpIndexer.java	Wed Dec  4 15:46:49 2002
@@ -150,7 +150,7 @@
                     		+ _module
                        		+ ".db";
 
-			table.open( fileName,null,Db.DB_BTREE,Db.DB_RDONLY,0644 );
+			table.open( null,fileName,null,Db.DB_BTREE,Db.DB_RDONLY,0644 );
 			Dbc cursor = table.cursor( null,0 );
 			StringDbt key = new StringDbt();
 			StringDbt data = new StringDbt();
@@ -440,7 +440,7 @@
                     		      + _module
                        		      + ".key";
 
-				table.open( fileName,null,Db.DB_BTREE,Db.DB_CREATE,0644 );
+				table.open( null,fileName,null,Db.DB_BTREE,Db.DB_CREATE,0644 );
 
             	for( int i = 0; i < list.length; ++i )
             	{
@@ -481,7 +481,7 @@
                     		+ _module
                        		+ ".ht";
 
-			table.open( fileName,null,Db.DB_BTREE,Db.DB_CREATE,0644 );
+			table.open( null,fileName,null,Db.DB_BTREE,Db.DB_CREATE,0644 );
 
             for( int i = 0; i < list.length; ++i )
             {
diff -uNr xmlhelp.old/source/cxxhelp/provider/databases.cxx xmlhelp/source/cxxhelp/provider/databases.cxx
--- oo/xmlhelp.old/source/cxxhelp/provider/databases.cxx	Wed Dec  4 15:19:26 2002
+++ oo/xmlhelp/source/cxxhelp/provider/databases.cxx	Wed Dec  4 15:33:41 2002
@@ -495,7 +495,11 @@
 		
 		rtl::OString fileName( fileNameOU.getStr(),fileNameOU.getLength(),osl_getThreadTextEncoding() );
 		
-		if( table->open( fileName.getStr(),0,DB_BTREE,DB_RDONLY,0644 ) )
+#if ((DB_VERSION_MAJOR * 10 + DB_VERSION_MINOR) >= 41)
+     		if( table->open( NULL, fileName.getStr(),0,DB_BTREE,DB_RDONLY,0644 ) )
+#else
+     		if( table->open( fileName.getStr(),0,DB_BTREE,DB_RDONLY,0644 ) )
+#endif
 		{
 			table->close( 0 );
 			delete table;
@@ -709,7 +713,11 @@
                                osl_getThreadTextEncoding() );
 		
 		Db table(0,DB_CXX_NO_EXCEPTIONS);
+#if ((DB_VERSION_MAJOR * 10 + DB_VERSION_MINOR) >= 41)
+		if( 0 == table.open( NULL, fileName.getStr(),0,DB_BTREE,DB_RDONLY,0644 ) )
+#else
 		if( 0 == table.open( fileName.getStr(),0,DB_BTREE,DB_RDONLY,0644 ) )
+#endif
 		{   
 			std::vector<KeywordInfo::KeywordElement> aVector;
 			Db* idmap = getBerkeley( Database,Language );
