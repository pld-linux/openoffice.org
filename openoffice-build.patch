diff -urN ooo-build-1.3.5.org/patches/vclplug/vcl-util.diff ooo-build-1.3.5/patches/vclplug/vcl-util.diff
--- ooo-build-1.3.5.org/patches/vclplug/vcl-util.diff	2004-10-09 16:20:24.877368692 +0200
+++ ooo-build-1.3.5/patches/vclplug/vcl-util.diff	2004-10-09 16:23:56.866954895 +0200
@@ -129,11 +129,10 @@
  # --- UNX ----------------------------------------------------------------
  
  .IF "$(GUI)"=="UNX"
-@@ -278,53 +256,126 @@ SHL1STDLIBS += -ldl
+@@ -256,53 +256,125 @@
  SHL1STDLIBS += -framework Cocoa
  .ENDIF
  
-+
 +SHL1STDLIBS += -lX11
 +
 +.ENDIF          # "$(GUI)"=="UNX"
@@ -144,26 +143,26 @@
 +# basic pure X11 plugin
 +LIB2TARGET=$(SLB)$/ipure_x
 +LIB2FILES= \
-+            $(SLB)$/salwin.lib  \
-+            $(SLB)$/salgdi.lib  \
-+            $(SLB)$/salapp.lib
++	$(SLB)$/salwin.lib  \
++	$(SLB)$/salgdi.lib  \
++	$(SLB)$/salapp.lib
 +SHL2TARGET=vclplug_gen$(UPD)$(DLLPOSTFIX)
 +SHL2IMPLIB=ipure_x
 +SHL2LIBS=  $(LIB2TARGET)
 +
 +# libs for generic plugin
 +SHL2STDLIBS=\
-+			$(VCLLIB)\
-+			-lpsp$(VERSION)$(DLLPOSTFIX)\
-+            $(SOTLIB)           \
-+            $(UNOTOOLSLIB)      \
-+            $(TOOLSLIB)         \
-+            $(COMPHELPERLIB)	\
-+            $(UCBHELPERLIB)     \
-+            $(CPPUHELPERLIB)    \
-+            $(CPPULIB)          \
-+            $(VOSLIB)           \
-+            $(SALLIB)
++	$(VCLLIB)\
++	-lpsp$(VERSION)$(DLLPOSTFIX)\
++	$(SOTLIB)           \
++	$(UNOTOOLSLIB)      \
++	$(TOOLSLIB)         \
++	$(COMPHELPERLIB)  \
++	$(UCBHELPERLIB)     \
++	$(CPPUHELPERLIB)    \
++	$(CPPULIB)          \
++	$(VOSLIB)           \
++	$(SALLIB)
 +
 +.IF "$(OS)"=="MACOSX"
 +SHL2STDLIBS += -lXinerama
@@ -207,56 +206,57 @@
 +SHL2STDLIBS += -lXinerama
  .ELSE
 -SHL1STDLIBS += -Wl,-Bstatic -lXinerama -Wl,-Bdynamic 
-+SHL2STDLIBS += -Wl,-Bstatic -lXinerama -Wl,-Bdynamic 
++SHL2STDLIBS += -Wl,-Bstatic -lXinerama -Wl,-Bdynamic
  .ENDIF          # $(XINERAMA_LINK)
  .ENDIF          # $(USE_XINERAMA)
 -SHL1STDLIBS += -lXext -lSM -lICE -lX11
 -.ENDIF          # "$(USE_XPRINT)" == "TRUE"
 +SHL2STDLIBS += -lXext -lSM -lICE -lX11
  .ENDIF          # "$(OS)"=="SOLARIS"
-+
- .ENDIF          # "$(GUIBASE)"=="unx"
+-.ENDIF          # "$(GUIBASE)"=="unx"
  
 -.IF "$(OS)"=="MACOSX"
 -SHL1STDLIBS += -lXinerama
 -.ENDIF
-+# dummy plugin
-+LIB3TARGET=$(SLB)$/idummy_plug_
-+LIB3FILES= \
-+            $(SLB)$/dapp.lib
-+SHL3TARGET=vclplug_dummy$(UPD)$(DLLPOSTFIX)
-+SHL3IMPLIB=idummy_plug_
-+SHL3LIBS=  $(LIB3TARGET)
-+
-+# libs for dummy plugin
-+SHL3STDLIBS=\
-+			$(VCLLIB)\
-+            $(SOTLIB)           \
-+            $(UNOTOOLSLIB)      \
-+            $(TOOLSLIB)         \
-+            $(COMPHELPERLIB)	\
-+            $(UCBHELPERLIB)     \
-+            $(CPPUHELPERLIB)    \
-+            $(CPPULIB)          \
-+            $(VOSLIB)           \
-+            $(SALLIB)
++.ENDIF          # "$(GUIBASE)"=="unx"
  
 -.IF "$(OS)"=="LINUX" || "$(OS)"=="SOLARIS" || "$(OS)"=="FREEBSD"
 -# some nas versions need -lXt, too
--SHL1STDLIBS += -lXt
+-#we must not link with Xt !!! it requires Xm which is not available on all platforms
 -SHL1STDLIBS += -laudio
 -.IF "$(OS)"=="SOLARIS"
 -# needed by libaudio.a
 -SHL1STDLIBS += -ldl -lnsl -lsocket
 -.ENDIF # SOLARIS
 -.ENDIF          # "$(OS)"=="LINUX" || "$(OS)"=="SOLARIS" || "$(OS)"=="FREEBSD"
++# dummy plugin
++LIB3TARGET=$(SLB)$/idummy_plug_
++LIB3FILES= \
++	$(SLB)$/dapp.lib
++SHL3TARGET=vclplug_dummy$(UPD)$(DLLPOSTFIX)
++SHL3IMPLIB=idummy_plug_
++SHL3LIBS=  $(LIB3TARGET)
++
++# libs for dummy plugin
++SHL3STDLIBS=\
++	$(VCLLIB)\
++	$(SOTLIB)           \
++	$(UNOTOOLSLIB)      \
++	$(TOOLSLIB)         \
++	$(COMPHELPERLIB)  \
++	$(UCBHELPERLIB)     \
++	$(CPPUHELPERLIB)    \
++	$(CPPULIB)          \
++	$(VOSLIB)           \
++	$(SALLIB)
++
 +# gtk plugin
 +.IF "$(ENABLE_GTK)" != ""
 +LIB4TARGET=$(SLB)$/igtk_plug_
 +LIB4FILES=\
-+			$(SLB)$/gtkapp.lib\
-+			$(SLB)$/gtkgdi.lib\
-+			$(SLB)$/gtkwin.lib
++	$(SLB)$/gtkapp.lib\
++	$(SLB)$/gtkgdi.lib\
++	$(SLB)$/gtkwin.lib
 +SHL4TARGET=vclplug_gtk$(UPD)$(DLLPOSTFIX)
 +SHL4IMPLIB=igtk_plug_
 +SHL4LIBS=$(LIB4TARGET)
Index: bin/package-ooo
===================================================================
RCS file: /cvs/gnome/ooo-build/bin/package-ooo,v
retrieving revision 1.51
diff -u -u -r1.51 package-ooo
--- ooo-build.org/bin/package-ooo	24 Sep 2004 17:43:51 -0000	1.51
+++ ooo-build/bin/package-ooo	10 Oct 2004 14:03:37 -0000
@@ -52,6 +52,33 @@
     cat <<EOT >$2
 #!/bin/sh
 
+# Keep in ~sync with ooo-wrapper
+
+SystemInstallDir="$OOINSTBASE"
+
+if [ -n "\$GNOME_DESKTOP_SESSION_ID" -a -d "\$SystemInstallDir/program/resource.gnome" ]; then
+    icon_set="gnome"
+elif [ -n "\$KDE_FULL_SESSION" -a -d "\$SystemInstallDir/program/resource.kde" ]; then
+    icon_set="kde"
+fi
+
+if [ -z "\$icon_set" ]; then
+    if [ -d "\$SystemInstallDir/program/resource.default" ]; then
+	icon_set="default"
+    elif [ -d "\$SystemInstallDir/program/resource.kde" ]; then
+	icon_set="kde"
+    elif [ -d "\$SystemInstallDir/program/resource.gnome" ]; then
+	icon_set="gnome"
+    else
+	icon_set="default"
+    fi
+fi
+    
+if [ -d "\$SystemInstallDir/program/resource.\$icon_set" ]; then
+    OOO_PREFERRED_RESOURCE_PATH="\$SystemInstallDir/program/resource.\$icon_set"
+    export OOO_PREFERRED_RESOURCE_PATH
+fi
+
 exec "$1" "\$@"
 EOT
     chmod 755 $2
